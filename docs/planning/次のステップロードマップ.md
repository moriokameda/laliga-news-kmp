# ラリーガニュースアプリ 次のステップロードマップ

## 1. 概要

### 1.1 現在の状況
- ✅ 段階1-5の実装完了（サンプルアプリレベル）
- ✅ Android/iOS両プラットフォームで動作確認済み
- ✅ UI/UX最終調整完了
- ✅ Kotlin Multiplatform 2025年版での実装

### 1.2 Kotlin Multiplatformの2025年状況
- **プロダクション準備完了**: KMPは実験的段階を脱し、本番環境での使用が推奨される
- **Compose Multiplatform iOS安定版**: 2025年5月にiOS向けCompose Multiplatformが安定版となる
- **企業採用増加**: Shopify、Forbes、Haier等の大手企業が本番環境で採用
- **Google公式サポート**: ビジネスロジック共有のための公式サポート発表

## 2. フェーズ別実装計画

### フェーズ1: リリース準備（1-2週間）

#### 1.1 アプリアイコンとアセット
```kotlin
// iosApp/LaLigaNews/Assets.xcassets/AppIcon.appiconset/
// 必要なアイコンサイズ:
// - iOS: 20pt, 29pt, 40pt, 60pt (各@2x, @3x)
// - Android: 48dp, 72dp, 96dp, 144dp, 192dp
```

**実装タスク**:
- [ ] アプリアイコンデザイン（ラリーガカラーを使用）
- [ ] 各プラットフォーム用アイコン生成
- [ ] スプラッシュスクリーン作成
- [ ] ストア用スクリーンショット作成（各言語）

#### 1.2 ビルド設定
```kotlin
// build.gradle.kts
android {
    defaultConfig {
        applicationId = "com.laliga.news"
        versionCode = 1
        versionName = "1.0.0"
    }
    
    buildTypes {
        release {
            isMinifyEnabled = true
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }
    
    signingConfigs {
        create("release") {
            storeFile = file("keystore/laliga-news-release.keystore")
            storePassword = System.getenv("KEYSTORE_PASSWORD")
            keyAlias = System.getenv("KEY_ALIAS")
            keyPassword = System.getenv("KEY_PASSWORD")
        }
    }
}
```

#### 1.3 プライバシーポリシーと規約
- [ ] プライバシーポリシー作成
- [ ] 利用規約作成
- [ ] GDPR対応（EU向け）
- [ ] iOS Privacy Manifest作成

### フェーズ2: バックエンドとAPI統合（2-3週間）

#### 2.1 Ktorバックエンド構築
```kotlin
// KtorプロジェクトのセットアップとAPI実装
// 詳細は「バックエンド構成と実装ガイド.md」を参照

// 主要エンドポイント:
// GET  /api/news         - ニュース一覧
// GET  /api/news/:id     - ニュース詳細
// POST /api/news/refresh - 最新ニュース取得
```

#### 2.2 ニュースAPI選定と統合
```kotlin
// 候補API（優先順位順）:
// 1. NewsAPI (newsapi.org) - 無料プラン1日1000リクエスト
// 2. The Guardian API - 無料プラン1日5000リクエスト
// 3. MediaStack - スポーツニュース対応、月500リクエスト無料
// 4. ESPN API（非公式） - ラリーガ専門、レート制限なし
```

#### 2.3 Microsoft Translator統合
```kotlin
// 選定理由:
// - 月200万文字まで無料（Google Cloudの4倍）
// - 高品質な翻訳
// - 簡単なセットアップ

class MicrosoftTranslatorService {
    suspend fun translateBatch(
        articles: List<NewsArticle>
    ): List<NewsArticle>
}
```

#### 2.4 Supabase統合
```kotlin
// 選定理由:
// - PostgreSQL基盤で構造化データに最適
// - リアルタイム機能付き（新着ニュース通知）
// - 500MB DB + 1GB ストレージ無料

// Realtime購読で新着ニュースを即座に配信
suspend fun subscribeToNewArticles(
    onNewArticle: (News) -> Unit
)
```

#### 2.5 キャッシュとオフライン対応
```kotlin
// Kotlin Multiplatform用のローカルDB
// SQLDelightを使用した実装
expect class DatabaseDriverFactory {
    fun createDriver(): SqlDriver
}

// commonMain
val database = Database(DatabaseDriverFactory().createDriver())

// キャッシュ戦略
class CachedNewsRepository(
    private val remoteDataSource: NewsApiService,
    private val localDataSource: NewsDao,
    private val translationService: TranslationService
) : NewsRepository {
    override suspend fun getNewsList(): List<NewsArticle> {
        return try {
            // オンライン時: API→翻訳→キャッシュ保存
            val remoteNews = remoteDataSource.getLatestNews()
            val translatedNews = translateIfNeeded(remoteNews)
            localDataSource.insertAll(translatedNews)
            translatedNews
        } catch (e: Exception) {
            // オフライン時: キャッシュから取得
            localDataSource.getAllNews()
        }
    }
}
```

### フェーズ3: 機能拡張（3-4週間）

#### 3.1 お気に入り機能
```kotlin
// presentation/viewmodel/FavoritesViewModel.kt
class FavoritesViewModel(
    private val favoritesRepository: FavoritesRepository
) {
    val favorites = favoritesRepository.getAllFavorites()
        .stateIn(viewModelScope, SharingStarted.Lazily, emptyList())
    
    fun toggleFavorite(article: NewsArticle) {
        viewModelScope.launch {
            if (article.isFavorite) {
                favoritesRepository.removeFavorite(article.id)
            } else {
                favoritesRepository.addFavorite(article)
            }
        }
    }
}

// UI更新
@Composable
fun NewsItemCard(
    article: NewsArticle,
    onFavoriteClick: () -> Unit
) {
    // お気に入りボタンを追加
    IconButton(onClick = onFavoriteClick) {
        Icon(
            imageVector = if (article.isFavorite) 
                Icons.Filled.Favorite else Icons.Outlined.FavoriteBorder,
            tint = if (article.isFavorite) LaLigaRed else Color.Gray
        )
    }
}
```

#### 3.2 チーム別フィルター
```kotlin
// domain/model/Team.kt
data class Team(
    val id: String,
    val name: String,
    val logo: String,
    val primaryColor: Color,
    val secondaryColor: Color
)

// ラリーガ20チームのデータ
val laLigaTeams = listOf(
    Team("real-madrid", "レアル・マドリード", "real_madrid_logo", Color.White, Color(0xFF004D98)),
    Team("barcelona", "バルセロナ", "barcelona_logo", Color(0xFF004D98), Color(0xFFA50044)),
    Team("atletico", "アトレティコ・マドリード", "atletico_logo", Color(0xFFCE1126), Color.White),
    // ... 他17チーム
)
```

### フェーズ4: 品質向上と最適化（2週間）

#### 4.1 テスト実装
```kotlin
// commonTest
class NewsRepositoryTest {
    @Test
    fun testGetNewsListSuccess() = runTest {
        val repository = FakeNewsRepository()
        val result = repository.getNewsList()
        
        assertTrue(result.isNotEmpty())
        assertEquals(10, result.size)
    }
}

// UI自動テスト (Compose Multiplatform Test)
@Test
fun newsListScreen_displaysCorrectly() {
    composeTestRule.setContent {
        NewsListScreen()
    }
    
    composeTestRule
        .onNodeWithText("ラリーガニュース")
        .assertIsDisplayed()
}
```

#### 4.2 パフォーマンス最適化
```kotlin
// 画像の遅延読み込みとキャッシュ
// Coil for Compose Multiplatform
AsyncImage(
    model = ImageRequest.Builder(LocalContext.current)
        .data(article.imageUrl)
        .crossfade(true)
        .memoryCacheKey(article.id)
        .diskCacheKey(article.id)
        .build(),
    contentDescription = article.title,
    modifier = Modifier.fillMaxSize()
)

// リスト最適化
LazyColumn(
    modifier = Modifier.fillMaxSize(),
    contentPadding = PaddingValues(vertical = 8.dp),
    verticalArrangement = Arrangement.spacedBy(8.dp)
) {
    items(
        items = articles,
        key = { it.id },
        contentType = { "news_item" }
    ) { article ->
        AnimatedNewsCard(article = article)
    }
}
```

### フェーズ5: 運用基盤構築（1-2週間）

#### 5.1 分析とクラッシュレポート
```kotlin
// Firebase統合（Android/iOS共通）
// commonMain
expect class Analytics {
    fun logEvent(name: String, params: Map<String, Any>)
    fun setUserProperty(name: String, value: String)
}

// androidMain
actual class Analytics {
    private val firebase = Firebase.analytics
    
    actual fun logEvent(name: String, params: Map<String, Any>) {
        firebase.logEvent(name) {
            params.forEach { (key, value) ->
                param(key, value.toString())
            }
        }
    }
}
```

#### 5.2 CI/CD設定
```yaml
# .github/workflows/release.yml
name: Release Build
on:
  push:
    tags:
      - 'v*'

jobs:
  android-release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup JDK
        uses: actions/setup-java@v4
        with:
          java-version: '21'
      
      - name: Build Release APK
        run: ./gradlew assembleRelease
        
      - name: Upload to Play Store
        uses: r0adkll/upload-google-play@v1
        with:
          serviceAccountJson: ${{ secrets.PLAY_STORE_JSON }}
          packageName: com.laliga.news
          releaseFiles: app/build/outputs/apk/release/*.apk
          
  ios-release:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - name: Build iOS App
        run: |
          cd iosApp
          xcodebuild archive \
            -project LaLigaNews.xcodeproj \
            -scheme LaLigaNews \
            -archivePath build/LaLigaNews.xcarchive
            
      - name: Upload to App Store
        run: |
          xcrun altool --upload-app \
            -f build/LaLigaNews.ipa \
            -u ${{ secrets.APPLE_ID }} \
            -p ${{ secrets.APP_SPECIFIC_PASSWORD }}
```

## 3. 技術的考慮事項

### 3.1 2025年のKMP最新機能活用
- **Amperビルドシステム**: Gradle依存を減らし、より簡潔な設定
- **Swift Export（Kotlin 2.2.20）**: iOS開発者向けのSwift API自動生成
- **K2コンパイラ**: 40%高速化されたコンパイル

### 3.2 アプリサイズ最適化
- Compose MultiplatformはiOSアプリに約9MBのオーバーヘッド
- R8/ProGuardによるAndroid最適化
- iOS App Thinningの活用

### 3.3 パフォーマンス考慮
- 起動時間: ネイティブアプリと同等を目指す
- スクロール性能: 高リフレッシュレートデバイスでも60fps維持
- メモリ使用量: 画像キャッシュの適切な管理

## 4. タイムライン

### 全体スケジュール（約3ヶ月）
```
2025年8月  : フェーズ1（リリース準備）
2025年8-9月: フェーズ2（API統合）
2025年9-10月: フェーズ3（機能拡張）
2025年10月 : フェーズ4（品質向上）
2025年10月末: フェーズ5（運用基盤）
2025年11月 : 本番リリース
```

### マイルストーン
1. **M1（8月中旬）**: アプリストア申請準備完了
2. **M2（9月初旬）**: 実APIでの動作確認
3. **M3（9月末）**: お気に入り機能リリース
4. **M4（10月中旬）**: ベータテスト開始
5. **M5（11月初旬）**: 本番リリース

## 5. リスクと対策

### 5.1 技術的リスク
| リスク | 影響度 | 対策 |
|-------|--------|------|
| APIレート制限 | 高 | キャッシュ戦略の最適化、複数API併用 |
| 翻訳品質 | 中 | DeepL APIの採用、人力チェック |
| iOSアプリ審査 | 高 | Privacy Manifest準備、ガイドライン遵守 |
| パフォーマンス問題 | 中 | 段階的な最適化、プロファイリング |

### 5.2 ビジネスリスク
| リスク | 影響度 | 対策 |
|-------|--------|------|
| 著作権問題 | 高 | APIプロバイダーの利用規約確認 |
| ラリーガ商標使用 | 高 | 公式ライセンス取得検討 |
| 競合アプリ | 中 | 差別化機能の追加 |

## 6. 成功指標

### 6.1 技術指標
- [ ] クラッシュ率 < 0.1%
- [ ] 起動時間 < 2秒
- [ ] API応答時間 < 1秒
- [ ] オフライン時も基本機能使用可能

### 6.2 ビジネス指標
- [ ] DAU 1,000人以上（リリース後3ヶ月）
- [ ] ストア評価 4.0以上
- [ ] 月間アクティブユーザー継続率 60%以上

## 7. 次のアクション

1. **即座に開始すべきこと**
   - アプリアイコンのデザイン依頼
   - API選定のための調査
   - Apple Developer Program登録

2. **1週間以内に決定すべきこと**
   - 使用するニュースAPI
   - 翻訳サービスの選定
   - リリーススケジュールの確定

3. **準備すべきドキュメント**
   - API仕様書
   - デプロイメント手順書
   - 運用マニュアル

---
作成日: 2025-07-31
バージョン: 1.0